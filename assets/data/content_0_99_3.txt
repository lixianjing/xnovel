孔明又唤姜维、廖化分付曰：“与汝二人一个锦囊，引三千精兵，偃旗息鼓，伏于前山之上。如见魏兵围住王平、张翼，十分危急，不必去救，只开锦囊看视，自有解危之策。”二人受计引兵而去。又令吴班、吴懿、马忠、张嶷四将，附耳分付曰：“如来日魏兵到，锐气正盛，不可便迎，且战且走。只看关兴引兵来掠阵之时，汝等便回军赶杀，吾自有兵接应。”四将受计引兵而去。又唤关兴分付曰：“汝引五千精兵，伏于山谷；只看山上红旗飐动，却引兵杀出。”兴受计引兵而去。<br/><br/>却说张郃、戴陵领兵前来，骤如风雨。马忠、张嶷、吴懿、吴班四将接着，出马交锋。张郃大怒，驱兵追杀。蜀兵且战且走，魏兵追赶约有二十余里，时值六月天气，十分炎热，人马汗如泼水。走到五十里外，魏兵尽皆气喘。孔明在山上把红旗一招，关兴引兵杀出。马忠等四将，一齐引兵掩杀回来。张郃、戴陵死战不退。忽然喊声大震，两路军杀出，乃王平、张翼也。各奋勇追杀，截其后路。郃大叫众将曰：“汝等到此，不决一死战，更待何时！”魏兵奋力冲突，不得脱身。忽然背后鼓角喧天，司马懿自领精兵杀到。懿指挥众将，把王平、张翼围在垓心。翼大呼曰：“丞相真神人也！计已算定，必有良谋。吾等当决一死战！”即分兵两路：平引一军截住张郃、戴陵，翼引一军力当司马懿。两头死战，叫杀连天。姜维、廖化在山上探望，见魏兵势大，蜀兵力危，渐渐抵当不住。维谓化曰：“如此危急，可开锦囊看计。”二人拆开视之，内书云：“若司马懿兵来围王平、张翼至急，汝二人可分兵两枝，竟袭司马懿之营；懿必急退，汝可乘乱攻之。营虽不得，可获全胜。”二人大喜，即分兵两路，径袭司马懿营中而去。原来司马懿亦恐中孔明之计，沿途不住的令人传报。懿正催战间，忽流星马飞报，言蜀兵两路竟取大寨去了，懿大惊失色，乃谓众将曰：“吾料孔明有计，汝等不信，勉强追来，却误了大事！”即提兵急回。军心惶惶乱走。张翼随后掩杀，魏兵大败。张郃、戴陵见势孤，亦望山僻小路而走，蜀兵大胜。背后关兴引兵接应诸路。司马懿大败一阵，奔入寨时，蜀兵已自回去。懿收聚败军，责骂诸将曰：“汝等不知兵法，只凭血气之勇，强欲出战，致有此败。今后切不许妄动，再有不遵，决正军法！”众皆羞惭而退。这一阵，魏军死者极多，遗弃马匹器械无数。却说孔明收得胜军马入寨，又欲起兵进取。忽报有人自成都来，说张苞身死。孔明闻知，放声大哭，口中吐血，昏绝于地。众人救醒。孔明自此得病卧床不起。诸将无不感激。后人有诗叹曰：“悍勇张苞欲建功，可怜天不助英雄！武侯泪向西风洒，为念无人佐鞠躬。”<br/><br/>