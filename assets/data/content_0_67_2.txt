张鲁大喜，即召庞德至，厚加赏劳；点一万军马，令庞德出。离城十余里，与曹兵相对，庞德出马搦战。曹操在渭桥时，深知庞德之勇，乃嘱诸将曰：“庞德乃西凉勇将，原属马超；今虽依张鲁，未称其心。吾欲得此人。汝等须皆与缓斗，使其力乏，然后擒之。”张郃先出，战了数合便退。夏侯渊也战数合退了。徐晃又战三五合也退了。临后许褚战五十余合亦退。庞德力战四将，并无惧怯。各将皆于操前夸庞德好武艺。曹操心中大喜，与众将商议：“如何得此人投降？”贾诩曰：“某知张鲁手下，有一谋士杨松。其人极贪贿赂。今可暗以金帛送之，使谮庞德于张鲁，便可图矣。”操曰：“何由得人入南郑？”诩曰：“来日交锋，诈败佯输，弃寨而走，使庞德据我寨。我却于夤夜引兵劫寨，庞德必退入城。却选一能言军士，扮作彼军，杂在阵中，便得入城。”操听其计，选一精细军校，重加赏赐，付与金掩心甲一副，今披在贴肉，外穿汉中军士号衣，先于半路上等候。<br/><br/>次日，先拨夏侯渊；张郃两枝军，远去埋伏；却教徐晃挑战，不数合败走。庞德招军掩杀，曹兵尽退。庞德却夺了曹操寨栅。见寨中粮草极多，大喜，即时申报张鲁；一面在寨中设宴庆贺。当夜二更之后，忽然三路火起：正中是徐晃、许褚，左张郃，右夏侯渊。三路军马，齐来劫寨。庞德不及提备，只得上马冲杀出来，望城而走。背后三路兵追来。庞德急唤开城门，领兵一拥而入。<br/><br/>此时细作已杂到城中，径投杨松府下谒见，具说：“魏公曹丞相久闻盛德，特使某送金甲为信。更有密书呈上。”松大喜，看了密书中言语，谓细作曰：“上覆魏公，但请放心。某自有良策奉报。”打发来人先回，便连夜入见张鲁，说庞德受了曹操贿赂，卖此一阵。张鲁大怒，唤庞德责骂，欲斩之。阎圃苦谏。张鲁曰：“你来日出战，不胜必斩！”庞德抱恨而退。次日，曹兵攻城，庞德引兵冲出。操令许褚交战。褚诈败，庞德赶来。操自乘马于山坡上唤曰：“庞令明何不早降？”庞德寻思：“拿住曹操，抵一千员上将！”遂飞马上坡。一声喊起，天崩地塌，连人和马，跌入陷坑内去；四壁钩索一齐上前，活捉了庞德，押上坡来。曹操下马，叱退军士，亲释其缚，问庞德肯降否。庞德寻思张鲁不仁，情愿拜降。曹操亲扶上马，共回大寨，故意教城上望见。人报张鲁，德与操并马而行。鲁益信杨松之言为实。次日，曹操三面竖立云梯，飞炮攻打。张鲁见其势已极，与弟张卫商议。卫曰：“放火尽烧仓廪府库，出奔南山，去守巴中可也。”杨松曰：“不如开门投降。”张鲁犹豫不定。卫曰：“只是烧了便行。”张鲁曰：“我向本欲归命国家，而意未得达；今不得已而出奔，仓廪府库，国家之有，不可废也。”遂尽封锁。是夜二更，张鲁引全家老小，开南门杀出。曹操教休追赶；提兵入南郑，见鲁封闭库藏，心甚怜之。遂差人往巴中，劝使投降。张鲁欲降，张卫不肯。杨松以密书报操，便教进兵，松为内应。操得书，亲自引兵往巴中。张鲁使弟卫领兵出敌，与许褚交锋；被褚斩于马下。败军回报张鲁，鲁欲坚守。杨松曰：“今若不出，坐而待毙矣。某守城，主公当亲与决一死战。”鲁从之。阎圃谏鲁休出。鲁不听，遂引军出迎。未及交锋，后军已走。张鲁急退，背后曹兵赶来。鲁到城下，杨松闭门不开。张鲁无路可走，操从后追至，大叫：“何不早降！”鲁乃下马投拜。操大喜；念其封仓库之心，优礼相待，封鲁为镇南将军。阎圃等皆封列侯。于是汉中皆平。曹操传令各郡分设太守，置都尉，大赏士卒。惟有杨松卖主求荣，即命斩之于市曹示众。后人有诗叹曰：“妨贤卖主逞奇功，积得金银总是空。家未荣华身受戮，令人千载笑杨松！”<br/><br/>