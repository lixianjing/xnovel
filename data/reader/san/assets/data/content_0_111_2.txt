却说邓艾知蜀兵出祁山，早与陈泰下寨准备；见蜀兵连日不来搦战，一日五番哨马出寨，或十里或十五里而回。艾凭高望毕。慌入帐与陈泰曰：“姜维不在此间，必取董亭袭南安去了。出寨哨马只是这几匹。更换衣甲，往来哨探，其马皆困乏，主将必无能者。陈将军可引一军攻之，其寨可破也。破了寨栅，便引兵袭董亭之路，先断姜维之后。吾当先引一军救南安，径取武城山。若先占此山头，姜维必取上邽。上邽有一谷，名曰段谷，地狭山险，正好埋伏。彼来争武城山时，吾先伏两军于段谷，破维必矣。”泰曰：“吾守陇西二三十年，未尝如此明察地理。公之所言，真神算也！公可速去，吾自攻此处寨栅。”于是邓艾引军星夜倍道而行，径到武城山；下寨已毕，蜀兵未到。即令子邓忠，与帐前校尉师篡，各引五千兵，先去段谷埋伏，如此如此而行。二人受计而去。艾令偃旗息鼓，以待蜀兵。却说姜维从董亭望南安而来，至武城山前，谓夏侯霸曰：“近南安有一山，名武城山；若先得了，可夺南安之势。只恐邓艾多谋，必先提防。”正疑虑间，忽然山上一声炮响，喊声大震，鼓角齐鸣，旌旗遍竖，皆是魏兵；中央风飘起一黄旗，大书邓艾字样。蜀兵大惊。山上数处精兵杀下，势不可当，前军大败。维急率中军人马去救时，魏兵已退。维直来武城山下搦邓艾战，山上魏兵并不下来。维令军士辱骂。至晚，方欲退军，山上鼓角齐鸣，却又不见魏兵下来。维欲上山冲杀，山上炮石甚严，不能得进。守至三更，欲回，山上鼓角又鸣，维移兵下山屯扎。比及令军搬运木石，方欲竖立为寨，山上鼓角又鸣，魏兵骤至。蜀兵大乱，自相践踏，退回旧寨。次日，姜维令军士运粮草车仗，至武城山，穿连排定，欲立起寨栅，以为屯兵之计。是夜二更，邓艾令五百人，各执火把，分两路下山，放火烧车仗。两兵混杀了一夜，营寨又立不成。<br/><br/>维复引兵退，再与夏侯霸商议曰：“南安未得，不如先取上邽。上邽乃南安屯粮之所；若得上邽，南安自危矣。”遂留霸屯于武城山，维尽引精兵猛将，径取上邽。行了一宿，将及天明，见山势狭峻，道路崎岖，乃问向导官曰：“此处何名？”答曰：“段谷。”维大惊曰：“其名不美：段谷者，断谷也。倘有人断其谷口，如之奈何？”正踌躇未决，忽前军来报：“山后尘头大起，必有伏兵。”维急令退兵。师篡、邓忠两军杀出，维且战且走，前面喊声大震，邓艾引兵杀到：三路夹攻，蜀兵大败。幸得夏侯霸引兵杀到，魏兵方退，救了姜维，欲再往祁山。霸曰：“祁山寨已被陈泰打破，鲍素阵亡，全寨人马皆退回汉中去了。”维不敢取董亭，急投山僻小路而回。后面邓艾急追，维令诸军前进，自为断后。正行之际，忽然山中一军突出，乃魏将陈泰也。魏兵一声喊起，将姜维困在垓心。维人马困乏，左冲右突，不能得出。荡寇将军张嶷，闻姜维受困，引数百骑杀入重围。维因乘势杀出。嶷被魏兵乱箭射死。维得脱重围，复回汉中，因感张嶷忠勇，殁于王事，乃表赠其子孙。于是，蜀中将士多有阵亡者，皆归罪于姜维。维照武侯街亭旧例，乃上表自贬为后将军，行大将军事。<br/><br/>